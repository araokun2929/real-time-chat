<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ</title>
    <style>
        /* ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: Arial, sans-serif;
            background-image: url('your-background-image-url.jpg'); /* èƒŒæ™¯ç”»åƒã®URLã‚’ã“ã“ã«å…¥åŠ› */
            background-size: cover; /* ç”»åƒã‚’ç”»é¢å…¨ä½“ã«æ‹¡å¤§ */
            background-repeat: no-repeat; /* ç”»åƒã‚’ç¹°ã‚Šè¿”ã•ãªã„ */
            color: #000000; /* æ–‡å­—è‰²ã‚’é»’ã« */
        }

        .chat-container {
            display: flex; /* å·¦å´ã¨å³å´ã‚’ä¸¦ã¹ã‚‹ */
            width: 80%;
            margin: 0 auto;
            background-color: rgba(30, 30, 30, 0.8); /* ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠã®èƒŒæ™¯è‰² */
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        .chat-box {
            width: 75%; /* å³å´ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ */
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
            margin-left: 10px;
            background-color: #ffffff; /* ãƒãƒ£ãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ã®èƒŒæ™¯ã‚’ç™½ã« */
            color: #000000; /* ãƒãƒ£ãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹å†…ã®æ–‡å­—è‰²ã‚’é»’ã« */
        }

        .participant-list {
            width: 25%; /* å³å´ã®å‚åŠ è€…ãƒªã‚¹ãƒˆ */
            border-left: 1px solid #ccc;
            padding-left: 10px;
            background-color: #ffffff; /* å‚åŠ è€…ãƒªã‚¹ãƒˆã®èƒŒæ™¯ã‚’ç™½ã« */
            color: #000000; /* å‚åŠ è€…ãƒªã‚¹ãƒˆå†…ã®æ–‡å­—è‰²ã‚’é»’ã« */
            height: 300px; /* å‚åŠ è€…ãƒªã‚¹ãƒˆã®é«˜ã•ã‚’è¨­å®š */
            overflow-y: auto; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
        }

        input[type="text"], button {
            padding: 10px;
            margin-top: 10px;
            width: calc(100% - 22px); /* å¹…ã‚’è‡ªå‹•èª¿æ•´ */
        }

        button {
            background-color: gold; /* ãƒœã‚¿ãƒ³ã®è‰²ã‚’é‡‘è‰²ã« */
            color: black; /* ãƒœã‚¿ãƒ³ã®æ–‡å­—è‰²ã‚’é»’ã« */
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #ffd700; /* ãƒ›ãƒãƒ¼æ™‚ã®è‰²ã‚’å°‘ã—æ˜ã‚‹ã */
        }

        /* ã‚¹ãƒãƒ›å‘ã‘ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column;
                width: 90%;
            }

            .participant-list, .chat-box {
                width: 100%; /* ã‚¹ãƒãƒ›ã§ã¯å…¨å¹… */
                border: none; /* ã‚¹ãƒãƒ›ã§ã¯å¢ƒç•Œç·šã‚’æ¶ˆã™ */
            }

            .chat-box {
                height: 200px; /* ã‚¹ãƒãƒ›ã§ã¯é«˜ã•ã‚’å°ã•ã */
            }
        }

        /* ã‚«ãƒ©ãƒ¼ãƒªã‚¹ãƒˆ */
        .color-palette {
            display: grid;
            grid-template-columns: repeat(6, 1fr); /* 6åˆ—ã®ã‚°ãƒªãƒƒãƒ‰ */
            gap: 5px;
            margin: 10px 0;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border: 1px solid #ccc;
            cursor: pointer;
        }

        /* çµµæ–‡å­—ãƒ”ãƒƒã‚«ãƒ¼ */
        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .emoji {
            cursor: pointer;
            font-size: 24px;
        }

        /* ã‚¢ãƒã‚¿ãƒ¼ãƒªã‚¹ãƒˆ */
        .avatar-picker {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .avatar {
            width: 50px;
            height: 50px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .avatar.selected {
            border-color: #007bff; /* é¸æŠã•ã‚ŒãŸã‚¢ãƒã‚¿ãƒ¼ã®æ ç·šè‰² */
        }

        .participant {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .participant img {
            width: 30px;
            height: 30px;
            margin-right: 5px;
        }
    </style>
</head>
<body>

    <div class="chat-container">
        <div class="chat-box" id="chat-box">
            <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
        <div class="participant-list" id="participant-list">
            <!-- å‚åŠ è€…ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
    </div>
    <input type="text" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›" />

    <!-- ã‚«ãƒ©ãƒ¼ãƒªã‚¹ãƒˆ -->
    <div class="color-palette">
        <div class="color-swatch" style="background-color: #ff0000;" data-color="#ff0000"></div>
        <div class="color-swatch" style="background-color: #00ff00;" data-color="#00ff00"></div>
        <div class="color-swatch" style="background-color: #0000ff;" data-color="#0000ff"></div>
        <div class="color-swatch" style="background-color: #ffff00;" data-color="#ffff00"></div>
        <div class="color-swatch" style="background-color: #ff00ff;" data-color="#ff00ff"></div>
        <div class="color-swatch" style="background-color: #00ffff;" data-color="#00ffff"></div>
        <div class="color-swatch" style="background-color: #000000;" data-color="#000000"></div>
        <div class="color-swatch" style="background-color: #ffffff; border: 1px solid #ccc;" data-color="#ffffff"></div>
    </div>
    
    <div class="avatar-picker" id="avatar-picker">
        <img src="avatar1.png" class="avatar" alt="" data-avatar="avatar1.png">
        <img src="avatar2.png" class="avatar" alt="" data-avatar="avatar2.png">
        <img src="avatar3.png" class="avatar" alt="" data-avatar="avatar3.png">
        <!-- ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’è¿½åŠ  -->
    </div>

    <input type="text" id="chat-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›">
    <button id="send-btn">é€ä¿¡</button>
    <button id="leave-btn">é€€å‡º</button> <!-- é€€å‡ºãƒœã‚¿ãƒ³ã‚’è¿½åŠ  -->

    <!-- Ablyã®CDNã‚’èª­ã¿è¾¼ã‚€ -->
    <script src="https://cdn.ably.io/lib/ably.min-1.js"></script>
    <script>
        // Ablyã®APIã‚­ãƒ¼
        const ably = new Ably.Realtime('q1CbLQ.AHN4Cg:DXjSkvPok_Uh1tIZ3Gkc-9dWcrH7fK71DWbltRug7No');
        const channel = ably.channels.get('chat-room');

        let selectedColor = '#000000'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‰²
        let selectedAvatar = 'avatar1.png'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒã‚¿ãƒ¼
        const participants = {}; // å‚åŠ è€…æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

        // å‚åŠ è€…ãƒªã‚¹ãƒˆã®æ›´æ–°
        function updateParticipantList() {
            const participantList = document.getElementById('participant-list');
            participantList.innerHTML = ''; // å‚åŠ è€…ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
            for (const username in participants) {
                const participant = document.createElement('div');
                participant.className = 'participant';
                const leaderMark = participants[username].isLeader ? "ğŸ‘‘ " : ""; // è¦ªåˆ†ãªã‚‰ç‹æ§˜ã®å† ã‚’ä»˜ã‘ã‚‹
                participant.innerHTML = `<img src="${participants[username].avatar}" alt="" style="width: 30px; height: 30px;"/> ${leaderMark}${username}`; // altå±æ€§ã‚’ç©ºã«
                participantList.appendChild(participant);
            }
        }

        // ã‚«ãƒ©ãƒ¼ãƒªã‚¹ãƒˆã®è‰²é¸æŠæ™‚
        document.querySelectorAll('.color-swatch').forEach(function(swatch) {
            swatch.addEventListener('click', function() {
                selectedColor = this.getAttribute('data-color'); // é¸æŠã—ãŸè‰²ã‚’å–å¾—
            });
        });

        // ã‚¢ãƒã‚¿ãƒ¼ã®é¸æŠæ™‚
        document.querySelectorAll('.avatar').forEach(function(avatar) {
            avatar.addEventListener('click', function() {
                selectedAvatar = this.getAttribute('data-avatar'); // é¸æŠã—ãŸã‚¢ãƒã‚¿ãƒ¼ã‚’å–å¾—
                document.querySelectorAll('.avatar').forEach(a => a.classList.remove('selected')); // ã™ã¹ã¦ã®ã‚¢ãƒã‚¿ãƒ¼ã®é¸æŠã‚’è§£é™¤
                this.classList.add('selected'); // é¸æŠã—ãŸã‚¢ãƒã‚¿ãƒ¼ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            });
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
        channel.subscribe('message', function(msg) {
            const chatBox = document.getElementById('chat-box');
            const newMessage = document.createElement('p');
            // è¦ªåˆ†ã®å‡¦ç†
            const messagePrefix = (participants[msg.data.username]?.isLeader ? "ğŸ‘‘ " : "") + msg.data.text; // è¦ªåˆ†ãªã‚‰ç‹æ§˜ã®å† ã‚’ä»˜ã‘ã‚‹
            newMessage.innerHTML = `<img src="${msg.data.avatar}" alt="" style="width: 20px; height: 20px; vertical-align: middle;"/> <span style="color: ${msg.data.color};">${msg.data.username}: ${messagePrefix}</span>`; // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‰²ä»˜ãã§è¡¨ç¤º
            chatBox.appendChild(newMessage);
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡é–¢æ•°
        function sendMessage() {
            const username = document.getElementById('username').value;
            const message = document.getElementById('chat-input').value;
            if (username && message) {
                channel.publish('message', { username: username, text: message, color: selectedColor, avatar: selectedAvatar }); // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
                document.getElementById('chat-input').value = ''; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            } else {
                alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            }
        }

        // é€ä¿¡ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ã
        document.getElementById('send-btn').addEventListener('click', sendMessage);

        // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        document.getElementById('chat-input').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
                event.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’é˜²ã
            }
        });

        // å‚åŠ è€…ãŒãƒãƒ£ãƒƒãƒˆã«å‚åŠ ã™ã‚‹éš›ã«å‘¼ã³å‡ºã™é–¢æ•°
        function joinChat(username) {
            if (!participants[username]) {
                participants[username] = { avatar: selectedAvatar, color: selectedColor, isLeader: Object.keys(participants).length === 0 }; // æ–°ã—ã„å‚åŠ è€…ã‚’è¿½åŠ 
                updateParticipantList(); // å‚åŠ è€…ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                
                // å…¥å®¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                const chatBox = document.getElementById('chat-box');
                const joinMessage = document.createElement('p');
                joinMessage.innerHTML = `<em>${username}ã•ã‚“ãŒå…¥å®¤ã—ã¾ã—ãŸã€‚</em>`;
                chatBox.appendChild(joinMessage); // å…¥å®¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

                // 3ç§’å¾Œã«å…¥å®¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
                setTimeout(() => {
                    chatBox.removeChild(joinMessage);
                }, 3000); // 3000ãƒŸãƒªç§’ï¼ˆ3ç§’ï¼‰å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
            }
        }

        // æœ€åˆã®å…¥å®¤è€…ã‚’è¦ªåˆ†ã«è¨­å®š
        document.getElementById('username').addEventListener('blur', function() {
            if (Object.keys(participants).length === 0) {
                joinChat(this.value); // åˆå›å…¥å®¤å‡¦ç†
            }
        });

        // é€€å‡ºãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ã
        document.getElementById('leave-btn').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            if (participants[username]) {
                // é€€å‡ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                const chatBox = document.getElementById('chat-box');
                const leaveMessage = document.createElement('p');
                leaveMessage.innerHTML = `<em>${username}ã•ã‚“ãŒé€€å‡ºã—ã¾ã—ãŸã€‚</em>`;
                chatBox.appendChild(leaveMessage); // é€€å‡ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

                // 3ç§’å¾Œã«é€€å‡ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
                setTimeout(() => {
                    chatBox.removeChild(leaveMessage);
                }, 3000); // 3000ãƒŸãƒªç§’ï¼ˆ3ç§’ï¼‰å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤

                const wasLeader = participants[username].isLeader; // é€€å‡ºå‰ã®è¦ªåˆ†çŠ¶æ…‹ã‚’ä¿å­˜
                delete participants[username]; // å‚åŠ è€…ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
                updateParticipantList(); // å‚åŠ è€…ãƒªã‚¹ãƒˆã‚’æ›´æ–°

                // è¦ªåˆ†ãŒé€€å‡ºã—ãŸå ´åˆã€æ¬¡ã®å‚åŠ è€…ã‚’è¦ªåˆ†ã«è¨­å®š
                if (wasLeader) {
                    const nextParticipant = Object.keys(participants)[0]; // æ¬¡ã®å‚åŠ è€…ã‚’å–å¾—
                    if (nextParticipant) {
                        participants[nextParticipant].isLeader = true; // æ¬¡ã®å‚åŠ è€…ã‚’è¦ªåˆ†ã«è¨­å®š
                        updateParticipantList(); // æ›´æ–°
                    }
                }
            } else {
                alert("ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã§ã¯é€€å‡ºã§ãã¾ã›ã‚“ã€‚"); // é€€å‡ºã§ããªã„å ´åˆã®è­¦å‘Š
            }
        });
    </script>

</body>
</html>


            
